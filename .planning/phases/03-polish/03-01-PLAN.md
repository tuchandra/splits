---
phase: 03-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/main.ts
  - src/index.html
autonomous: true

must_haves:
  truths:
    - "User can see item breakdown for each person's share"
    - "User can expand/collapse breakdown details per person"
    - "User can copy a plain text summary to clipboard"
    - "Copied feedback is visible and accessible"
  artifacts:
    - path: "src/main.ts"
      provides: "generateSummary function and enhanced renderSharesSection"
      contains: "generateSummary"
    - path: "src/main.ts"
      provides: "Copy button with clipboard API"
      contains: "navigator.clipboard"
  key_links:
    - from: "Copy Summary button"
      to: "generateSummary function"
      via: "click handler calls generateSummary then writeText"
      pattern: "generateSummary.*clipboard\\.writeText"
    - from: "renderSharesSection"
      to: "PersonShare.items"
      via: "renders item breakdown"
      pattern: "share\\.items"
---

<objective>
Enhance the Individual Shares section with expandable breakdown details and add a "Copy Summary" button that exports a plain text summary to clipboard.

Purpose: Users need to see what items each person had (OUT-01) and share the split results easily (OUT-02).

Output: Enhanced shares display with `<details>` elements for breakdown, Copy Summary button with inline "Copied!" feedback.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-polish/03-RESEARCH.md

@src/main.ts
@src/lib/calculate.ts
@src/index.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance Individual Shares with expandable breakdown</name>
  <files>src/main.ts, src/index.html</files>
  <action>
Modify renderSharesSection in main.ts to show item breakdown per person:

1. Change each share row to use native `<details>/<summary>` elements:
   - Summary shows: person name and total amount (current behavior)
   - Details shows: list of items with name and share amount, plus tax/tip breakdown

2. Structure for each share:
   ```html
   <details class="share-details">
     <summary class="share-row">
       <span class="share-name">Alice</span>
       <span class="share-amount">$25.50</span>
     </summary>
     <div class="share-breakdown">
       <div class="breakdown-item">
         <span>Burger (split 2 ways)</span>
         <span>$8.00</span>
       </div>
       <div class="breakdown-totals">
         <div>Subtotal: $12.00</div>
         <div>Tax: $1.02</div>
         <div>Tip: $2.40</div>
       </div>
     </div>
   </details>
   ```

3. For items split among multiple people, show "(split N ways)" annotation.

4. Add CSS to index.html:
   - .share-details for the details container
   - .share-breakdown for the expanded content
   - .breakdown-item for each item row (flex, space-between)
   - .breakdown-totals for the tax/tip summary
   - Style summary to hide default arrow, add custom indicator if desired
   - Ensure accessible focus states on details/summary
  </action>
  <verify>
Open the app with diners and dishes assigned. Each share row is now expandable. Click to expand and see item list + tax/tip breakdown. Tab to each details element works.
  </verify>
  <done>
Share rows are expandable with `<details>`, showing item breakdown (with split annotation) and tax/tip amounts when expanded.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Copy Summary button with plain text export</name>
  <files>src/main.ts, src/index.html</files>
  <action>
Add a "Copy Summary" button and generateSummary function:

1. Create generateSummary function in main.ts:
   ```typescript
   function generateSummary(): string {
     const lines: string[] = [];
     lines.push("Bill Split Summary");
     lines.push("==================");
     lines.push("");

     // Get calculation result (same as renderSharesSection)
     const namedDiners = getNamedDiners();
     const namedDishes = state.dishes.filter(d => d.name.trim() !== "");

     if (namedDiners.length === 0 || namedDishes.length === 0) {
       return "No bill to summarize";
     }

     const billInput: BillInput = { ... };  // Same as in renderSharesSection
     const result = calculateBill(billInput);

     for (const share of result.shares) {
       lines.push(`${share.personId}: ${formatCents(share.totalCents)}`);
       for (const item of share.items) {
         lines.push(`  - ${item.itemName}: ${formatCents(item.shareCents)}`);
       }
       if (share.taxCents > 0) {
         lines.push(`  Tax: ${formatCents(share.taxCents)}`);
       }
       if (share.tipCents > 0) {
         lines.push(`  Tip: ${formatCents(share.tipCents)}`);
       }
       lines.push("");
     }

     lines.push(`Total: ${formatCents(result.totalCents)}`);
     return lines.join("\n");
   }
   ```

2. Add Copy Summary button in renderSharesSection, after the shares list:
   - Button text: "Copy Summary"
   - On click: call navigator.clipboard.writeText(generateSummary())
   - IMPORTANT: Keep clipboard call synchronous in click handler (Safari compatibility per RESEARCH.md)

3. Add inline "Copied!" feedback:
   - After successful copy, change button text to "Copied!" for 2 seconds
   - Add aria-live region for screen reader announcement
   - Button class changes to "copy-success" temporarily

4. Add CSS for copy button:
   ```css
   .copy-container { margin-top: 16px; }
   .copy-btn {
     padding: 8px 16px;
     background: #4a90d9;
     color: white;
     border: none;
     border-radius: 4px;
     cursor: pointer;
   }
   .copy-btn:hover { background: #3a7fc8; }
   .copy-success { background: #22c55e; }
   .copy-feedback {
     position: absolute;
     width: 1px;
     height: 1px;
     overflow: hidden;
     clip: rect(0, 0, 0, 0);
   }
   ```
   (The .copy-feedback is visually hidden but announced by screen readers)
  </action>
  <verify>
1. Open app with data entered
2. Click "Copy Summary" button
3. Button text changes to "Copied!" briefly
4. Paste in a text editor - see formatted plain text summary
5. Test with screen reader if available (VoiceOver on Mac: Cmd+F5)
  </verify>
  <done>
Copy Summary button copies plain text to clipboard with inline "Copied!" feedback. Screen reader users hear the status announcement.
  </done>
</task>

</tasks>

<verification>
1. Open http://localhost:3000 (or bun dev server)
2. Add 2+ diners, 3+ dishes with assignments
3. Expand a share row - see item breakdown with split annotations and tax/tip
4. Click "Copy Summary" - see "Copied!" feedback
5. Paste into Notes/TextEdit - verify formatted summary
6. Test on mobile viewport (expand/collapse still works, button still clickable)
</verification>

<success_criteria>
- Individual Shares rows are expandable showing item breakdown
- Copy Summary button copies formatted plain text to clipboard
- Copied feedback shows inline (no toast/modal)
- All features work on mobile layout
- Accessible: keyboard navigable, screen reader announces copy status
</success_criteria>

<output>
After completion, create `.planning/phases/03-polish/03-01-SUMMARY.md`
</output>
