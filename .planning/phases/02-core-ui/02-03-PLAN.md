---
phase: 02-core-ui
plan: 03
type: execute
wave: 3
depends_on: [02-01, 02-02]
files_modified:
  - src/main.ts
autonomous: true

must_haves:
  truths:
    - "User can toggle individual diner chips to assign/unassign from a dish"
    - "User can click 'All' to assign everyone to a dish"
    - "Unassigned dishes show warning border and 'Unassigned' label"
    - "Only named diners appear as chips"
    - "Individual Shares section shows each person's total"
    - "Shares update live on every change"
  artifacts:
    - path: "src/main.ts"
      provides: "Assignment chips, unassigned indicator, live shares display"
      contains: "calculateBill"
  key_links:
    - from: "Assignment chips"
      to: "state.dishes[].assignedTo"
      via: "toggle click handler"
      pattern: "assignedTo"
    - from: "src/main.ts"
      to: "src/lib/calculate.ts"
      via: "import calculateBill"
      pattern: "import.*calculateBill"
    - from: "Individual Shares"
      to: "calculateBill result"
      via: "render on every state change"
      pattern: "calculateBill.*shares"
---

<objective>
Build assignment interaction and live individual shares display.

Purpose: Complete the core interaction loop - users assign dishes to diners and immediately see how much each person owes. This connects the data entry to the calculation engine.

Output: Toggleable diner chips on each dish, "All" quick-toggle, unassigned dish warnings, and live-updating Individual Shares section showing each person's calculated total.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-core-ui/02-CONTEXT.md
@.planning/phases/02-core-ui/02-01-SUMMARY.md
@.planning/phases/02-core-ui/02-02-SUMMARY.md
@src/main.ts
@src/lib/calculate.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add assignment chips to dish rows</name>
  <files>src/main.ts</files>
  <action>
Modify the dish row rendering to add assignment chips:

1. **Chips container** below each dish's inputs (or to the side on desktop):
   - Use `getNamedDiners()` to get only non-empty diner names
   - For each named diner, render a chip/button showing the name

2. **Chip styling** (per CONTEXT.md):
   - **Assigned** (diner is in dish.assignedTo): filled/solid background (blue or primary color), white text
   - **Not assigned**: outlined style (border only, no fill), normal text color
   - Both states should be visually distinct and clickable

3. **Chip click handler**:
   - Toggle: if diner is in dish.assignedTo, remove them; if not, add them
   - Update state.dishes[index].assignedTo array
   - Re-render (shares will update automatically)

4. **"All" quick-toggle button** (per CONTEXT.md):
   - Add an "All" button/chip at the start or end of the chips row
   - Click behavior:
     - If ALL named diners are currently assigned: unassign everyone (set assignedTo = [])
     - Otherwise: assign everyone (set assignedTo = [...getNamedDiners()])
   - Style: could be same chip style, maybe slightly different (e.g., outlined always, or different color)

5. **Responsive layout** (per CONTEXT.md):
   - Desktop: chips can be in a column to the right of dish inputs, or inline
   - Mobile: chips below the dish row (flex-wrap handles this naturally)
   - Use CSS media queries or flex-wrap: wrap

6. **Edge cases**:
   - If no named diners exist, show no chips (or a hint "Add diners above")
   - If a diner is deleted while assigned to dishes, their name should be removed from assignedTo arrays (add cleanup in the diner delete handler from Plan 01)
  </action>
  <verify>
`bun build ./src/index.html --outdir=dist` succeeds.
Manual test:
1. Add diners "Alice", "Bob", "Carol"
2. Add a dish "Pizza"
3. See three name chips below/beside Pizza
4. Click "Alice" - chip becomes filled, Alice is assigned
5. Click "Alice" again - chip becomes outlined, Alice unassigned
6. Click "All" - all three become assigned (filled)
7. Click "All" again - all three become unassigned (outlined)
  </verify>
  <done>
Assignment chips render for each dish. Clicking toggles assignment state with visual feedback (filled vs outlined). "All" button assigns/unassigns everyone.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add unassigned indicator and live Individual Shares</name>
  <files>src/main.ts</files>
  <action>
Part A - Unassigned dish indicator (per CONTEXT.md):

1. **Warning styling on dish card**:
   - If dish.assignedTo.length === 0 (or no named diners in assignedTo):
     - Add warning border color (amber/orange) to the dish card
     - Show "Unassigned" text label below or beside the dish
   - If assigned to at least one person: normal styling, no label

2. **Visual distinction**:
   - Warning border should be noticeable but not jarring (2-3px amber/orange)
   - "Unassigned" label in warning color text

Part B - Individual Shares section (per CONTEXT.md):

3. **Section header**: "Individual Shares" as h2 or styled div

4. **Live calculation**:
   - Build BillInput from current state:
     ```typescript
     const billInput: BillInput = {
       items: state.dishes.map(d => ({
         id: d.id,
         name: d.name,
         amountCents: d.quantity * d.unitPriceCents,
         assignedTo: d.assignedTo,
       })),
       taxCents: state.taxCents,
       tipCents: state.tipCents,
       feesCents: 0, // Not using fees in this app per CONTEXT.md
       participants: getNamedDiners(),
     };
     const result = calculateBill(billInput);
     ```
   - This runs on every render (live updates)

5. **Shares display**:
   - For each PersonShare in result.shares:
     - Show: "{person name}: {formatCents(totalCents)}"
     - Could include breakdown: subtotal + tax + tip = total (optional, Claude discretion)
   - Style as a clean list or small cards

6. **Unassigned items warning** (optional enhancement):
   - If result.unassignedItems.length > 0, could show count of unassigned items
   - Already handled by dish-level warning, so this is optional

7. **Empty state**:
   - If no diners: show "Add diners to see shares"
   - If no dishes: show "Add dishes to see shares"
   - If diners and dishes exist: show the calculated shares

8. **Verify totals make sense**:
   - The sum of all shares should equal calculated total
   - Already verified by calculateBill, just display it

Styling (Claude discretion):
- Shares section could be visually distinct (different background, card style)
- Person name left-aligned, amount right-aligned
- Mobile: full width, stacked rows
  </action>
  <verify>
`bun build ./src/index.html --outdir=dist` succeeds.
`bunx tsc --noEmit` passes.
Manual test:
1. Add diners "Alice", "Bob"
2. Add dish "Burger" $20.00, assign to Alice only
3. Add dish "Fries" $5.00, leave unassigned
4. See: Fries has warning border and "Unassigned" label
5. See Individual Shares: Alice $20.00 (or with tax/tip if entered)
6. Enter Tax: $2.00 - Alice share updates to include proportional tax
7. Assign Fries to Bob - warning disappears, Bob appears in shares with $5.00 + proportional
8. Click All on Burger - splits between Alice and Bob, shares update live
  </verify>
  <done>
Unassigned dishes show warning border and "Unassigned" label. Individual Shares section displays each person's calculated total, updating live on every change.
  </done>
</task>

<task type="auto">
  <name>Task 3: Final polish and responsive testing</name>
  <files>src/main.ts</files>
  <action>
1. **Mobile responsiveness check** (per UX-01):
   - Test layout at 375px width (mobile)
   - Ensure all sections stack vertically
   - Ensure inputs are usable (not too small)
   - Ensure chips wrap properly below dish rows
   - Add/adjust CSS media queries as needed

2. **Tab flow verification**:
   - Verify tab order makes sense: Diner inputs -> Dish name -> qty -> price -> next dish -> ... -> Tax -> Tip -> Total
   - Adjust tabindex if needed for logical flow

3. **Empty state polish**:
   - On fresh load (no localStorage), show helpful empty states
   - "Add diners to get started" in Diners section
   - "Add dishes to split" in Dishes section

4. **Visual consistency pass**:
   - Consistent spacing between sections
   - Consistent button styling (Add Diner, Add Dish)
   - Consistent input styling across all fields
   - Warning colors consistent (same amber/orange for unassigned and total mismatch)

5. **Edge case handling**:
   - Dish with qty=0: line total shows $0.00
   - Dish with price=0: valid (maybe a free item)
   - Diner deleted while assigned: clean up assignedTo arrays
   - All diners deleted: chips disappear, shares show empty state

6. **Performance sanity check**:
   - With 5+ diners and 10+ dishes, UI should still be responsive
   - No obvious lag on re-renders (vanilla DOM should handle this fine)
  </action>
  <verify>
`bun build ./src/index.html --outdir=dist` succeeds.
`bunx tsc --noEmit` passes.
Manual testing checklist:
- [ ] Mobile (375px): all sections usable, chips wrap, inputs tappable
- [ ] Desktop: layout uses available width appropriately
- [ ] Tab flow: logical order through inputs
- [ ] Empty states: helpful messages when no data
- [ ] Edge cases: qty=0, price=0, delete assigned diner all work
- [ ] Performance: 5 diners, 10 dishes - no lag
  </verify>
  <done>
UI is responsive on mobile, tab flow is logical, empty states are helpful, edge cases handled, and performance is acceptable.
  </done>
</task>

</tasks>

<verification>
1. `bun build ./src/index.html --outdir=dist` completes without errors
2. `bunx tsc --noEmit` passes
3. All 12 Phase 2 requirements verified:
   - ENTRY-01: Add line items (dish with name, qty, price)
   - ENTRY-02: Edit existing items
   - ENTRY-03: Delete items
   - ENTRY-04: Enter tax, tip, fees (fees=0, tax/tip work)
   - ASSIGN-01: Assign item to one or more people (chips)
   - ASSIGN-02: Assign to everyone ("All" button)
   - ASSIGN-03: See unassigned items (warning border + label)
   - ASSIGN-04: Running total vs expected (Bill Totals validation)
   - FRIEND-01: localStorage preset diners
   - FRIEND-02: Add new diners on the fly
   - FRIEND-03: Select participating friends (diners section)
   - UX-01: Mobile-friendly responsive
4. Live calculation works (Individual Shares updates on every change)
5. Full flow test: add diners, add dishes, assign, enter tax/tip, see correct shares
</verification>

<success_criteria>
- Assignment chips toggle correctly (filled/outlined)
- "All" button assigns/unassigns everyone
- Unassigned dishes have warning border and label
- Individual Shares displays each person's total
- Shares update live on any change (no Calculate button)
- Responsive design works on mobile (375px)
- All Phase 2 requirements met
- calculateBill integration works correctly
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-ui/02-03-SUMMARY.md`
</output>
